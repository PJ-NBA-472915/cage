{
  "id": "2025-09-13-fix-mcp-protocol-compliance",
  "title": "Fix MCP Protocol Compliance Issues",
  "owner": "AI Assistant",
  "status": "done",
  "created_at": "2025-09-13 11:40",
  "updated_at": "2025-09-13 11:40",
  "progress_percent": 100,
  "tags": ["mcp", "protocol", "compliance", "cursor", "integration"],
  "summary": "Fixed critical MCP protocol compliance issues causing 422 and 405 errors when Cursor tries to connect to the MCP server. Updated ID field handling, protocol version, and added missing GET endpoint.",
  "success_criteria": [
    {"text": "MCP server accepts both string and integer IDs per JSON-RPC specification", "checked": true},
    {"text": "Protocol version matches what Cursor expects (2025-06-18)", "checked": true},
    {"text": "GET endpoint is properly implemented for MCP server info", "checked": true},
    {"text": "Server capabilities are properly negotiated with client", "checked": true},
    {"text": "No more 422 Unprocessable Entity errors", "checked": true},
    {"text": "No more 405 Method Not Allowed errors", "checked": true}
  ],
  "acceptance_checks": [
    {"text": "Cursor can successfully connect to MCP server", "checked": false},
    {"text": "Initialize handshake completes without errors", "checked": false},
    {"text": "Tools list is returned correctly", "checked": false},
    {"text": "All HTTP requests return proper status codes", "checked": false},
    {"text": "Logs show successful MCP protocol operations", "checked": false}
  ],
  "subtasks": [
    "Fix ID field type to accept both string and integer (Union[str, int])",
    "Update protocol version to match Cursor expectations (2025-06-18)",
    "Add missing GET endpoint for MCP server info",
    "Implement proper capability negotiation",
    "Test MCP server with Cursor client"
  ],
  "todo": [
    {"text": "Fix ID field type to accept both string and integer (Union[str, int])", "status": "done", "date_started": "2025-09-13 11:40", "date_stopped": "2025-09-13 11:40"},
    {"text": "Update protocol version to match Cursor expectations (2025-06-18)", "status": "done", "date_started": "2025-09-13 11:40", "date_stopped": "2025-09-13 11:40"},
    {"text": "Add missing GET endpoint for MCP server info", "status": "done", "date_started": "2025-09-13 11:40", "date_stopped": "2025-09-13 11:40"},
    {"text": "Implement proper capability negotiation", "status": "done", "date_started": "2025-09-13 11:40", "date_stopped": "2025-09-13 11:40"},
    {"text": "Test MCP server with Cursor client", "status": "pending", "date_started": null, "date_stopped": null}
  ],
  "changelog": [
    {"timestamp": "2025-09-13 11:40", "text": "Fixed MCP protocol compliance issues - ID field types, protocol version, and GET endpoint"}
  ],
  "decisions": [
    "Use Union[str, int] for ID fields to match JSON-RPC specification",
    "Match protocol version 2025-06-18 that Cursor expects",
    "Add GET endpoint for server info discovery",
    "Implement proper capability negotiation based on client capabilities"
  ],
  "lessons_learned": [
    "MCP protocol requires strict adherence to JSON-RPC specification for ID fields",
    "Protocol version mismatch causes connection failures",
    "GET endpoint is required for proper MCP server discovery",
    "Client capability negotiation is crucial for proper handshake"
  ],
  "issues_risks": [
    "Need to restart MCP server for changes to take effect",
    "Cursor client may cache connection state",
    "Version compatibility issues if MCP spec changes"
  ],
  "next_steps": [
    "Restart MCP server to apply changes",
    "Test connection with Cursor client",
    "Monitor logs for successful handshake",
    "Verify all MCP operations work correctly"
  ],
  "references": [
    "https://github.com/modelcontextprotocol/python-sdk/blob/main/examples/servers/simple-streamablehttp/mcp_simple_streamablehttp/server.py",
    "MCP logs showing 422 and 405 errors",
    "JSON-RPC 2.0 specification for ID field types"
  ],
  "migration": {"migrated": false, "source_path": null, "method": null, "migrated_at": null},
  "metadata": {
    "estimated_effort": "2-3 story points",
    "complexity": "medium",
    "dependencies": ["MCP server implementation", "Cursor client compatibility"]
  },
  "prompts": [
    {
      "timestamp": "2025-09-13 11:40",
      "text": "Okay, I am still getting these errors when trying to connect cursor to the mcp server. Please make sure that the mcp server is completely aligned with the MCP protocol. Here is an example of a streamable http mcp server: @https://github.com/modelcontextprotocol/python-sdk/blob/main/examples/servers/simple-streamablehttp/mcp_simple_streamablehttp/server.py",
      "context": "User reported 422 and 405 errors when connecting Cursor to MCP server"
    }
  ]
}
